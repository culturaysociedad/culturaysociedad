import{j as t,u as z,r,S as D}from"./index-BUgPTFGp.js";import{C as A}from"./CreatePostForm-i1bFPgEt.js";import{P as B}from"./PostCard-3jK9S98J.js";import{u as H}from"./postStore-DuIi636r.js";import{E as O}from"./EventoCulturalCard-2PU1jNMo.js";import{C as R}from"./CreateEventForm-DdOBZWVR.js";import V from"./StoriesPage-CsniOj8-.js";import"./AudioRecorder-cPYNjE-N.js";import"./native-BERrg2Ri.js";import"./send-s1K8CqpS.js";import"./ellipsis-XNX0qr4A.js";import"./share-2-DjPP6-S7.js";import"./endOfMonth-8J98MCwT.js";import"./es-DgAR10vS.js";import"./chevron-right--SgFWIc5.js";const W=({type:n="post"})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),n==="event"&&t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),t.jsxs("div",{className:"flex space-x-4 mt-2",children:[t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),$=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],ie=()=>{var y,h,b,f,j,w,N,k,E,_;const{posts:n,isLoading:L,fetchPosts:u}=H(),{events:i,isLoading:T,fetchEvents:d}=z(),[a,o]=r.useState(null),[l,F]=r.useState("feed"),[q,p]=r.useState(n),[I,g]=r.useState(i);r.useEffect(()=>{p(n)},[n]),r.useEffect(()=>{g(i)},[i]),r.useEffect(()=>{u(),d()},[u,d]);const[M]=r.useState([]),x=[...q.map(e=>({type:"post",date:new Date(e.createdAt),post:e})),...I.filter(e=>e.date&&!isNaN(new Date(e.date).getTime())).map(e=>({type:"event",date:new Date(e.date),event:e})),...M.map(e=>({type:"birthday",date:new Date(e.date),birthday:e}))],v=l==="feed"?x.slice().sort((e,s)=>e.type==="post"&&s.type==="post"&&"post"in e&&"post"in s?s.post.likes.length-e.post.likes.length:e.type==="post"?-1:s.type==="post"?1:s.date.getTime()-e.date.getTime()):x.slice().sort((e,s)=>s.date.getTime()-e.date.getTime());return t.jsxs("div",{className:"w-full pb-24 bg-white dark:bg-gray-900",children:[t.jsx(V,{}),t.jsx("div",{className:"w-full",children:t.jsx(A,{className:"rounded-none mx-0",onSuccess:()=>{setTimeout(()=>{const e=document.querySelector(".feed-item");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}})}),t.jsx("div",{className:"block sm:hidden mb-2 w-full",children:t.jsx(D,{})}),t.jsx("div",{className:"hidden sm:block w-full",children:t.jsx(D,{})}),a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-4 w-full max-w-lg relative animate-fade-in",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>o(null),children:"✕"}),t.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),t.jsx(R,{date:new Date(a.date),onSuccess:()=>{o(null),d()},onCancel:()=>o(null),initialData:{id:a.id,title:a.title,description:a.description,event_type:a.type,date:a.date.split("T")[0],location:a.location,target_audience:["Infantil","Adultos","Todo Público"].includes(((y=a.metadata)==null?void 0:y.target_audience)??"")?(h=a.metadata)==null?void 0:h.target_audience:void 0,cost:{type:"free"},responsible_person:((b=a.metadata)==null?void 0:b.responsible_person)||{name:"",phone:""},technical_requirements:((f=a.metadata)==null?void 0:f.technical_requirements)||[],image_url:a.imagen_url,tags:((j=a.metadata)==null?void 0:j.tags)||[],recurrence:(w=a.metadata)!=null&&w.recurrence&&typeof((N=a.metadata)==null?void 0:N.recurrence.type)=="string"&&["custom","none","daily","weekly","monthly"].includes((k=a.metadata)==null?void 0:k.recurrence.type)?{...(E=a.metadata)==null?void 0:E.recurrence,type:(_=a.metadata)==null?void 0:_.recurrence.type}:{type:"none"}}})]})}),t.jsx("div",{className:"flex justify-center gap-2 my-2 sm:my-4",children:$.map(e=>t.jsx("button",{className:`px-3 py-1 sm:px-4 sm:py-2 rounded-full font-semibold transition-colors duration-150 text-xs sm:text-base ${l===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>F(e.value),"aria-pressed":l===e.value,children:e.label},e.value))}),L||T?t.jsx("div",{children:[...Array(3)].map((e,s)=>t.jsx(W,{type:"post"},s))}):v.length===0?t.jsxs("div",{className:"card py-8 text-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay novedades aún"}),t.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación, evento o cumpleaños para comenzar!"})]}):t.jsx("div",{className:"w-full",children:v.map(e=>{var s,C,S,P;return e.type==="post"&&"post"in e?t.jsx(B,{post:e.post,onDeleted:()=>p(c=>c.filter(m=>m.id!==e.post.id))},e.post.id):e.type==="event"&&"event"in e?t.jsx(O,{event:{id:e.event.id,titulo:e.event.title,descripcion:e.event.description,fecha_inicio:e.event.date,ubicacion:e.event.location||"",imagen_url:e.event.imagen_url,categoria:"",tipo:e.event.type,userId:e.event.userId,metadata:{target_audience:((s=e.event.metadata)==null?void 0:s.target_audience)||"",responsible_person:((C=e.event.metadata)==null?void 0:C.responsible_person)||{name:"",phone:""},technical_requirements:((S=e.event.metadata)==null?void 0:S.technical_requirements)||[],tags:((P=e.event.metadata)==null?void 0:P.tags)||[]}},onEdit:()=>o(e.event),onDeleted:()=>g(c=>c.filter(m=>m.id!==e.event.id))},e.event.id):e.type==="birthday"&&"birthday"in e?t.jsxs("div",{className:"card feed-item rounded-none mx-0",children:["Cumpleaños: ",e.birthday.name]},e.birthday.id):null})}),t.jsx("div",{className:"fixed bottom-20 right-4 z-40",children:t.jsx("button",{className:"btn btn-primary rounded-full p-4 shadow-lg text-lg flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-primary-500",onClick:()=>window.dispatchEvent(new CustomEvent("openConversationsModal")),"aria-label":"Escribir mensaje",tabIndex:0,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 12c0 4.556-4.686 8.25-9.75 8.25-1.13 0-2.25-.17-3.3-.5l-4.2 1.25a.75.75 0 01-.94-.94l1.25-4.2c-.33-1.05-.5-2.17-.5-3.3C2.25 7.186 5.944 2.5 12 2.5s9.75 4.686 9.75 9.5z"})})})})]})};export{ie as default};
