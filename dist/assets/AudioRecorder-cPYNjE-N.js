import{c as h,r as e,j as a,s as R,d as I}from"./index-BUgPTFGp.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],q=h("file-text",P);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],D=h("mic",U);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],E=h("music",$),T=e.forwardRef(({onAudioReady:d,folder:b="media"},x)=>{const[i,u]=e.useState(!1),[y,c]=e.useState(!1),[w,s]=e.useState(0),[M,p]=e.useState(0),[k,l]=e.useState(!1),t=e.useRef(null),g=e.useRef([]),n=e.useRef(null),A=async()=>{console.log("[AudioRecorder] startRecording called"),p(0),s(0),c(!1),l(!1),window.navigator.vibrate&&window.navigator.vibrate([50,30,50]);const m=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new window.MediaRecorder(m);t.current=r,g.current=[],r.ondataavailable=o=>{g.current.push(o.data)},r.onstop=async()=>{console.log("[AudioRecorder] onstop called");const o=new Blob(g.current,{type:"audio/webm"});l(!0),await _(o)},r.start(),u(!0),n.current=setInterval(()=>p(o=>o+1),1e3),console.log("[AudioRecorder] recording started")},j=()=>{console.log("[AudioRecorder] stopRecording called"),t.current&&i&&(u(!1),n.current&&clearInterval(n.current),t.current.stop(),console.log("[AudioRecorder] mediaRecorder.stop() called"))},N=()=>{console.log("[AudioRecorder] cancelRecording called"),u(!1),c(!1),s(0),p(0),l(!1),d(null),n.current&&clearInterval(n.current),t.current&&t.current.state!=="inactive"&&(t.current.stop(),console.log("[AudioRecorder] mediaRecorder.stop() called from cancel"))},_=async m=>{console.log("[AudioRecorder] uploadAudio called"),c(!0),s(0);try{const r=`${b}/audio_${Date.now()}_${Math.random().toString(36).substring(2,8)}.webm`;for(let f=1;f<=90;f+=10)await new Promise(S=>setTimeout(S,60)),s(f);const{error:o}=await R.storage.from("media").upload(r,m);if(s(100),c(!1),l(!1),o)throw o;const{data:v}=R.storage.from("media").getPublicUrl(r);console.log("[AudioRecorder] upload success, url:",v.publicUrl),d(v.publicUrl)}catch(r){c(!1),s(0),l(!1),d(null),I.error("Error al subir audio"),console.error("[AudioRecorder] upload error",r)}};return e.useImperativeHandle(x,()=>({startRecording:A,stopRecording:j,cancelRecording:N,isRecording:()=>i,isUploading:()=>y})),a.jsxs("div",{className:"space-y-2",children:[i&&a.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.jsxs("div",{className:"relative p-6 rounded-full bg-red-100 text-red-600 shadow-lg border-4 border-red-300",children:[a.jsx("span",{className:"absolute inset-0 rounded-full border-2 border-red-400 animate-ping"}),a.jsx("span",{className:"font-bold text-lg animate-pulse",children:"‚óè"})]}),a.jsxs("span",{className:"text-red-600 font-mono animate-pulse",children:[M,"s"]})]}),k&&a.jsx("div",{className:"w-full bg-gray-200 rounded h-2",children:a.jsx("div",{className:"bg-primary-500 h-2 rounded",style:{width:`${w}%`}})})]})});export{T as A,q as F,D as M,E as a};
