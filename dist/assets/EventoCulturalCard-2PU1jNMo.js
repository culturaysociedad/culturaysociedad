import{r as c,e as H,R as F,j as e,d as u,l as b,q as P,H as $,M as z,s as n}from"./index-BUgPTFGp.js";import{g as E}from"./postStore-DuIi636r.js";import{E as B}from"./ellipsis-XNX0qr4A.js";import{S as T}from"./send-s1K8CqpS.js";import{e as j}from"./es-DgAR10vS.js";const J=({event:a,onEdit:v,disableCardNavigation:M,onDeleted:w})=>{const[S,d]=c.useState(!1),[p,N]=c.useState(""),[m,f]=c.useState([]),[k,C]=c.useState({}),[h,y]=c.useState([]),[g,q]=c.useState(!1),{user:t}=H(),L=t&&a.userId&&t.id===a.userId,x=t?h.includes(t.id):!1;F.useEffect(()=>{const r=async()=>{const{data:s}=await n.from("comentarios_evento").select("*").eq("evento_id",a.id).order("creado_en",{ascending:!0});if(f(s||[]),s&&s.length>0){const i={};await Promise.all(Array.from(new Set(s.map(l=>l.autor_id))).map(async l=>{const _=await E(l);_&&(i[l]=_)})),C(i)}},o=async()=>{const{data:s}=await n.from("reacciones_evento").select("usuario_id").eq("evento_id",a.id);y(s?s.map(i=>i.usuario_id):[])};r(),o()},[a.id]);const A=async()=>{t&&(x?(await n.from("reacciones_evento").delete().eq("evento_id",a.id).eq("usuario_id",t.id),y(h.filter(r=>r!==t.id))):(await n.from("reacciones_evento").insert({evento_id:a.id,usuario_id:t.id}),y([...h,t.id])))},I=async r=>{if(r.preventDefault(),!(!p.trim()||!t))try{const{data:o,error:s}=await n.from("comentarios_evento").insert({evento_id:a.id,autor_id:t.id,contenido:p.trim()}).select().single();if(s)throw s;let i=k[t.id];i||(i=await E(t.id),C(l=>({...l,[t.id]:i}))),f([...m,o]),N("")}catch{u.error("Error al agregar el comentario")}},R=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:r}=await n.from("eventos").delete().eq("id",a.id);if(r)throw r;u.success("Evento eliminado exitosamente"),typeof w=="function"&&w()}catch{u.error("Error al eliminar el evento")}},U=()=>{navigator.share?navigator.share({title:a.titulo,text:a.descripcion,url:window.location.origin+"/eventos/"+a.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+a.id),u.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-none sm:rounded-lg shadow-md overflow-hidden mb-6 mx-0 sm:mx-auto",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:a.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:a.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a.descripcion})]}),e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline focus:ring-2 focus:ring-primary-500",onClick:r=>{r.stopPropagation(),d(o=>!o)},"aria-label":"Abrir menú de opciones del evento","data-menu":"evento-menu",children:e.jsx(B,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),S&&e.jsx("div",{className:"absolute right-0 top-10 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/eventos/"+a.id),d(!1),u.success("¡Enlace copiado!")},"aria-label":"Copiar enlace del evento",children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:U,"aria-label":"Compartir evento",children:"Compartir evento"})}),L&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{d(!1),v&&v()},"aria-label":"Editar evento",children:"Editar evento"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await R(),d(!1)},"aria-label":"Eliminar evento",children:"Eliminar evento"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:r=>{r.stopPropagation(),d(!1)},"aria-label":"Cerrar menú de opciones",children:"Cancelar"})})]})})]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:a.categoria||a.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),M?e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",b(new Date(a.fecha_inicio),"dd MMM yyyy",{locale:j})]}):e.jsx(P,{to:`/eventos/${a.id}`,className:"group hover:underline",children:e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",b(new Date(a.fecha_inicio),"dd MMM yyyy",{locale:j})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:A,className:"flex items-center space-x-1 group focus:outline focus:ring-2 focus:ring-primary-500","aria-pressed":x,"aria-label":x?"Quitar me gusta":"Dar me gusta",type:"button",children:[e.jsx($,{className:`h-5 w-5 ${x?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${x?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:h.length})]}),e.jsxs("button",{onClick:()=>q(!g),className:"flex items-center space-x-1 group focus:outline focus:ring-2 focus:ring-primary-500","aria-expanded":g,"aria-label":g?"Ocultar comentarios":"Mostrar comentarios",type:"button",children:[e.jsx(z,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:m.length})]})]}),g&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic",children:"No hay comentarios aún."}):m.map(r=>{const o=r.autor_id===(t==null?void 0:t.id),s=k[r.autor_id];return e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:(s==null?void 0:s.avatar_url)||"https://ui-avatars.com/api/?name="+encodeURIComponent((s==null?void 0:s.name)||""),alt:s==null?void 0:s.name,className:"h-8 w-8 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s==null?void 0:s.name}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:b(new Date(r.creado_en),"dd MMM yyyy HH:mm",{locale:j})})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.contenido}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:e.jsxs("button",{onClick:async()=>{o&&(await n.from("comentarios_evento").delete().eq("id",r.id),f(m.filter(i=>i.id!==r.id)))},className:"text-red-600 dark:text-red-400 text-xs flex items-center space-x-1 hover:underline","aria-label":"Eliminar comentario",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{children:"Eliminar"})]})})]})]},r.id)})}),t&&e.jsx("form",{onSubmit:I,className:"mt-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:t.avatar_url||"https://ui-avatars.com/api/?name="+encodeURIComponent(t.name),alt:t.name,className:"h-8 w-8 rounded-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:p,onChange:r=>N(r.target.value),className:"w-full p-3 text-sm rounded-lg border focus:outline-none focus:ring-1 focus:ring-primary-500 resize-none",rows:2,placeholder:"Escribe un comentario...","aria-label":"Escribe un comentario"})}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm bg-primary-600 hover:bg-primary-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Agregar comentario",children:e.jsx(T,{className:"h-5 w-5"})})]})})]})]})]})};export{J as E};
